---
alias: 'Mobile App Command'
icon: 'mdi:run'
mode: 'parallel'
max: 10
trace:
  stored_traces: 20

fields:
  target:
    name: 'Target Device'
    description: 'Target device to send the notification to.'
    required: true
    selector:
      device:
        integration: 'mobile_app'
  command:
    name: 'Command'
    required: true
    selector:
      select:
        # See https://companion.home-assistant.io/docs/notifications/notification-commands/.
        options:
          - 'command_dnd'
          - 'request_location_update'
  data:
    name: 'Data'
    required: false
    selector:
      text: {}

variables:
  device: >-
    {% if device_attr(target, 'id') is not none %}
      {{ device_attr(target, 'name_by_user') | regex_replace(find="'s\\b", replace="") | slugify }}
    {% else %}
      {{ target }}
    {% endif %}

sequence:
  service: 'notify.mobile_app_{{ device }}'
  data:
    message: '{{ command }}'
    title: '{{ data | default }}'
